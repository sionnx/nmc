import { expect, test } from 'vitest'
import { eapiReqDecrypt, eapiResDecrypt } from '../util/crypto'

test('eapi request decrypt', () => {
    let encryptedRequestParams = "A2F79236092FBB3F68F1C1B7CEF26DF2349905508F8E5B85FEF31652F883463FED08393DC98E36F88F717B71DBB0AB7C5620FB8A7C16F46A6B239B8BF8556A5213D1A8251BCFE2EC3348057B67A1EF6BB1583AD6E507D4208059996FAED66AA32EFB7E493F6C633BA2B93FA7E0CB6F686CBA19AED84A779505650D52C281D5A51A507ACDCB61A2F6A1C1D943BA4AD956777926CCED9E854E9DF41A66ED69AF177EDF7D1867E27586DC8193CDABC0FA8CEAB38AB8094317EE3F9AEBD1D3E818E61EF649D3EF093EA42B85A944F122368CF7E4F9FAF1134E1AA630AE5A0A2FEC65C7D5111597333A4AB7FC38A128D1B74E20EC696FE49639A04A53334078A052A5157B1EAE00ABE8C1708B777599EB517CAB68BECD32AF89F9C03AFC2BD196E06CB4159EDB1D6C88E0CC5A7EE336A23003F8F5BE33BE05554476179004294A4C9CE808EE82079EA880F5D5930A0029AE8E5B50EADA4432110FE9B6BA234B782F3822B682203FAEE6C0DCB1027073DB40EC44C10DBCA0F5AC73EAC595EDEB616C833F93C44F5F94D4EE0B42EF05F8675107E3828412E19E61970ED2ACE987D44BF06DBBC32B1D9C496FF0B122BC0D59518BFD63FC72EEDE89F78BCF70B9566EFE246E778B10E2BB02D877B7774D7BC46410CDF81336202D538CFA14849C0BE11E289A4440697E8E64B3631024FE1D6108118BC66E8FFE48565515C606476234581C"
    let decryptedRequestParams = eapiReqDecrypt(encryptedRequestParams)
    expect(decryptedRequestParams).toBeDefined()
    expect(decryptedRequestParams?.url).toBe("/api/search/pc/result/tab")
    expect(decryptedRequestParams?.data).toBeDefined()
})

test('eapi response decrypt', () => {
    let encryptedResponseBody = `
    DC C5 2B 30 13 E9 B6 6C 03 8F 8E 02 7E 58 0E CE
34 44 95 45 2F 81 0B CB 82 41 A1 F3 55 02 71 ED
3D 85 66 F3 63 FB BF FD 3C C9 5F 5C 09 7C 80 2A
DA 28 5F 6C 97 F8 41 50 5F EE F0 0D E9 D8 67 1C
F4 A8 57 26 F3 05 0D 4B 84 84 EA A1 02 8A C2 6A
1D 10 7A 8F 54 1B C7 3E A7 77 4F D0 D2 03 DC AB
DB A9 98 1F AB 99 36 B6 1C E6 4F 04 FC 2E B5 AA
B7 0B 4A 09 1C C0 44 BF 54 EB 52 4F F4 D7 0B 9D
2E 52 1A DB CA 85 2B D1 30 CA 37 D7 09 41 5E E4
E9 53 69 4B 56 E9 2C 33 B3 AD 99 98 54 25 1E EC
91 48 4E 5B 44 2E 75 83 7A 72 80 D9 B5 AD D5 E2
52 FE 6F 1C 2F 11 96 61 01 D3 31 84 E3 CF 32 58
B2 3E 70 05 92 4B 01 BB EB F9 66 6A A8 F2 10 8C
60 CE 1D 08 12 48 AD A9 04 37 99 C5 20 50 94 0B
34 1F 10 7E D3 21 7F 65 BD 9E E1 F0 B9 C4 D4 7A
4E 6F 39 47 38 4D E9 8D CE 7A F4 6E AD B4 FC A7
AE B8 8D 25 16 F2 5F 5B 4B 94 63 48 1C C3 B8 D8
5A 17 A0 4E 56 0B 84 15 B4 0F 1D 2F A5 A4 2F 29
18 09 91 F6 A7 68 32 4A 82 19 4A 56 47 A3 07 99
9B 9B C6 B4 9A 46 2B 3F 21 CE 8D 96 87 14 D5 21
48 5D F7 C3 63 DE 4E 06 5D 71 32 73 F9 6E 77 06
60 5C 9F 68 45 4F 04 F8 21 C0 93 22 07 AD D9 5A
A9 EA 18 25 FD 0E F1 D9 F2 0C 2B 7C D3 52 77 8F
EC F2 7C 63 5E 9A C6 45 12 E0 DA D0 9D 2F 96 F2
E1 FE 37 E0 5D BE CC E7 7A E6 A9 B7 D3 6F D8 A9
6D E4 5D BB D8 D7 FE 7D FD 94 0E 62 0A 76 99 F6
8E 55 3A 99 3E CF AE DE 7C DA B6 50 44 F6 9B 20
65 27 78 EC 0F 85 D7 3E 0A E3 21 BA AF C0 10 A5
99 57 A6 46 78 D8 EC FA B2 D0 02 92 66 DA 4C 70
19 E0 16 CB 12 41 85 C7 2A 5D 3A 7A 23 AF F4 E8
AB 7F AF 13 BB 31 A0 FD BA E9 E1 FF 53 53 4B DA
56 D5 F3 38 01 1B 3E 8F DE 2F EF EC 1D 6F 38 19
0F FE 7D E4 57 93 2D 84 88 70 60 03 60 BE B1 3B
DF E8 8B 54 D7 1C 24 D6 F8 BD 3C 68 A3 26 04 D0
DB AF FB 1B F9 44 4B 9A 93 54 B7 8B 2D 2C A1 2D
`
    const decryptedData = eapiResDecrypt(encryptedResponseBody)

    expect(decryptedData).toBeDefined()
    expect(decryptedData.code).toBe(200)
    expect(decryptedData.message).toBe("")
    expect(decryptedData.data).toBeDefined()
})